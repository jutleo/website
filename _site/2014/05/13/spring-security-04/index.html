<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>spring security 自定义认证实现</title>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
        <!-- Custom CSS -->
        <link rel="stylesheet" href="/static/css/leo.css">
        <link rel="stylesheet" href="/static/css/prettify.css">

    </head>
    <body>
      <div class="leo-head">
        <ul class="leo-nav">
  
    <li><a class="leo-nav-item" href="/">首页</a></li>
  
    <li><a class="leo-nav-item" href="/category.html">归档</a></li>
  
    <li><a class="leo-nav-item" href="/andy.html">豆豆</a></li>
  
    <li><a class="leo-nav-item last" href="/contant.html">联系我</a></li>
  
</ul>

      </div>
          </div>
      <div class="container">
        <div class="row">
          <div class="col-md-8"><div class="leo-category"><h1 class="leo-articel-title">spring security 自定义认证实现</h1>
<div class="post">
<h2>开篇</h2>

<p>&emsp;接上篇，<code>spring security</code>为我们实现了基于cas的认证，但是在实际项目中经常会遇到非cas的情况，这就需要我们基于spring security
实现自定义的认证，所谓自定义认证即可以自由扩展实现和第三方的SSO、SAM等无缝对接认证。  </p>

<p>&emsp;本文的前提是你对<code>spring security</code>有一定的理解，请参阅之前提到的<code>spring security</code>理论，或者查阅官方文档，记得本系列是在2.0.8基础上
做说明。如果是3.x版本会有小的差异。  </p>

<p>&emsp;第三方认证，其实就是提供一个认证提供者，拿到用户名、密码之后调用第三方验证是否合法用户。下来实际操作一番：  </p>

<p>&emsp;首先，你需要实现<code>AuthenticationProvider</code>接口，并实现<code>authenticate</code>方法和<code>supports</code>方法，完整代码如下： </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">public class LeoAuthenticationProvider implements AuthenticationProvider{

    private UserDetailsService userDetailsService;

    public void setUserDetailsService(UserDetailsService userDetailsService) {
        this.userDetailsService = userDetailsService;
    }

    @Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        //1、获取用户名、密码
        String username = authentication.getName();
        String password = authentication.getPrincipal().toString();

        //2、调用第三方认证
        boolean isSuccess = thirdPartyAuthenticate(username, username);

        //3、通过UserDetailsService构建UserDetails
        UserDetails userDtails = null;
        if(isSuccess) {
            userDtails = userDetailsService.loadUserByUsername(username);
            GrantedAuthorityImpl authority = new GrantedAuthorityImpl(&quot;ROLE_EVERYONE&quot;);
            userDtails.getAuthorities();
        }
        //4、返回令牌对象
        return new UsernamePasswordAuthenticationToken(username, username, userDtails.getAuthorities());
    }

    @Override
    public boolean supports(Class authentication) {
        //判断authentication是不是一个合法的可支持的对象，一般为实现了Authentication接口的实现类，
        //spring security为我们提供了默认的实现类UsernamePasswordAuthenticationToken
        return true;
    }
    //第三方认证实现，这里判断用户名和密码相等就OK，实际根据三方提供的接口来实现，返回boolean值即可
    private boolean thirdPartyAuthenticate(String username, String password) {
        if(username.equals(password)) {
            return true;
        } else {
            return false;
        }
    }
}
</code></pre></div>
<p>&emsp;代码很简单，有注释，应该不难理解。下来看看如何配置： </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">//认证管理
&lt;security:authentication-manager alias=&quot;authenticationManager&quot; /&gt;

//认证提供者
&lt;bean id=&quot;leoAuthenticationProvider&quot; class=&quot;org.leo.security.LeoAuthenticationProvider&quot;&gt;
    &lt;property name=&quot;userDetailsService&quot; ref=&quot;userDetailsService&quot;/&gt;
    &lt;security:custom-authentication-provider /&gt;
&lt;/bean&gt;
</code></pre></div>
<p>&emsp;OK，至此，一个完整的三方SSO集成已经实现，有兴趣可以自己动手尝试一下。</p>

</div>
<p class="leo-protect">
  作者：
  <a href="/">leo</a>
  　发布时间：2014年05月13日
  <br>
  原文：
  <a href="/2014/05/13/spring-security-04">spring security 自定义认证实现</a>
  <br>
  标签： spring
  <br/>
  版权所有，转载时必须以链接形式注明作者和原出处并保留本声明。
  <br>
</p>
<script type="text/javascript" src="/static/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="/static/js/prettify.js"></script>
<script type="text/javascript">
  $(function(){
    $("pre").addClass("prettyprint linenums");
    prettyPrint();
  });
</script>

<!-- Duoshuo Comment BEGIN -->
  <div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"jutleo"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- Duoshuo Comment END --></div></div>
          <div class="col-md-4">
            <div class="list-group">
              <a href="#" class="list-group-item list-group-item-success disabled">分类</a>
              
              <a href="/db/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">1</span>db </a>
              
              <a href="/server/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">2</span>server </a>
              
              <a href="/office/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">1</span>office </a>
              
              <a href="/javascript/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">6</span>javascript </a>
              
              <a href="/ireport/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">15</span>ireport </a>
              
              <a href="/blog/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">1</span>blog </a>
              
              <a href="/orm/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">2</span>orm </a>
              
              <a href="/technology/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">1</span>technology </a>
              
              <a href="/life/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">3</span>life </a>
              
              <a href="/spring/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">5</span>spring </a>
              
            </div>
            <div class="leo-article-category">
              <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=2975520964&verifier=eac976c7&dpc=1"></iframe>
            </div>

          </div>
      </div>

        </div>
        
      <div class="leo-foot">
        <p>
 Copyright &copy; 2010 - 2014 &nbsp;jutleo@gmail.com. 保留所有权利。
</p>
      </div>
    </body>
</html>
