<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>iReport+jasperReport之客户端打印</title>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
        <!-- Custom CSS -->
        <link rel="stylesheet" href="/static/css/leo.css">
        <link rel="stylesheet" href="/static/css/prettify.css">

    </head>
    <body>
      <div class="leo-head">
        <ul class="leo-nav">
  
    <li><a class="leo-nav-item" href="/">首页</a></li>
  
    <li><a class="leo-nav-item" href="/category.html">归档</a></li>
  
    <li><a class="leo-nav-item" href="/andy.html">豆豆</a></li>
  
    <li><a class="leo-nav-item last" href="/contant.html">联系我</a></li>
  
</ul>

      </div>
          </div>
      <div class="container">
        <div class="row">
          <div class="col-md-8"><div class="leo-category"><h1 class="leo-articel-title">iReport+jasperReport之客户端打印</h1>
<div class="post">
<p>jasperReport客户端采用applet，applet和activeX插件的区别大家搜一下，有一堆东西可以借鉴。
下载jasperreports-3.0.0，在相应的sample OR demo（记得不清了）中可以找到jasperReport 实现的客户端打印demo，下来就来分析下具体实现。</p>

<p>*<em>新建一print.js文件: *</em>  </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">function loadApplet(applet_URL) {
    var URL = applet_URL + &quot;/applets/jre-1_5_0_18-windows-i586-p.exe&quot;;
    document.write(&#39;&lt;OBJECT id=&quot;myApplet&quot; name=&quot;myApplet&quot;&#39;);
    document.write(&#39;classid=&quot;clsid:8AD9C840-044E-11D1-B3E9-00805F499D93&quot; WIDTH=&quot;0&quot; HEIGHT=&quot;0&quot; MAYSCRIPT name=&quot;myApplet&quot;&#39;);
    document.write(&#39;codebase=&#39;+ URL +&#39;&gt;&#39;);
    document.write(&#39;&lt;PARAM NAME=&quot;CODE&quot; VALUE=&quot;org.bulktree.report.print.applet.PrinterApplet&quot; /&gt;&#39;);
    document.write(&#39;&lt;PARAM NAME=&quot;CODEBASE&quot; VALUE=&quot;../applets&quot; /&gt;&#39;);
    document.write(&#39;&lt;PARAM NAME=&quot;ARCHIVE&quot; VALUE=&quot;jasperreports-3.0.1-applet.jar&quot; /&gt;&#39;);
    document.write(&#39;&lt;PARAM NAME=&quot;type&quot; VALUE=&quot;application/x-java-applet;version=1.5.0&quot; /&gt;&#39;);
    document.write(&#39;&lt;PARAM NAME=&quot;scriptable&quot; VALUE=&quot;false&quot; /&gt;&#39;);
    document.write(&#39;&lt;PARAM NAME=&quot;REPORT_URL&quot; VALUE=&quot;../report.view&quot;&gt;&#39;);
    document.write(&#39;no support java&#39;);
    document.write(&#39;&lt;comment&gt;&#39;);
    document.write(&#39;&lt;embed type=&quot;application/x-java-applet;version=1.5.0&quot;&#39;);
    document.write(&#39;CODE=&quot;org.bulktree.report.print.applet.PrinterApplet&quot;&#39;);
    document.write(&#39;JAVA_CODEBASE=&quot;applets&quot; ARCHIVE=&quot;jasperreports-3.0.1-applet.jar&quot;&#39;);
    document.write(&#39;scriptable=false&#39;);
    document.write(&#39;pluginspage=&#39;+ URL +&#39;&gt;&#39;);
    document.write(&#39;&lt;noembed&gt;&lt;/noembed&gt;&#39;);
    document.write(&#39;&lt;/embed&gt;&#39;);
    document.write(&#39;&lt;/comment&gt;&#39;);
    document.write(&#39;&lt;/OBJECT&gt;&#39;);
}
</code></pre></div>
<p>URL为一个固定的路径，是为了下载/applets/jre-1<em>5</em>0<em>18-windows-i586-p.exe（JRE运行环境）而存在的，也可以使用外网从sun公司网站下载。
REPORT</em>URL 为applet所要访问的地址，在工程的web.xml配置/report.view如下servlet即可。
此servet可接收applet参数，生成jasperPrint对象，并传递到客户端applet中进行打印或者预览。  </p>

<p><strong>servlet配置如下：</strong></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;servlet&gt;
    &lt;servlet-name&gt;ReportServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.bulktree.report.print.applet.ReportServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;ReportServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/report.view&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</code></pre></div>
<p>ReportServlet核心代码就是根据业务找到对应的模板文件填充数据生成jasperPrint对象，产生的jasperPrint对象以对象流的形式发送给客户端，核心代码如下：  </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">// 生成jasperPrint对象
JasperPrint jasperPrint = JasperFillManager.fillReport(jasperReport,mapParam, new JREmptyDataSource());

//组装流
response.setContentType(&quot;application/octet-stream&quot;);
response.setBufferSize(8986000);
ServletOutputStream outStream = response.getOutputStream();
ObjectOutputStream oos = new ObjectOutputStream(outStream);
oos.writeObject(jasperPrint);
</code></pre></div>
<p>当然，客户端的applet使用如下：  </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/*
 * applet与Servlet交互 URL传递页面传来的参数请求服务器Servlet
 * 把applet传递的参数追加到servlet中 2008-10-14 jutleo
 */

url = new URL(getCodeBase(), requestUrl + &quot;?printView=true&quot;
        + paraStr);

if (url == null) {
    JOptionPane.showMessageDialog(this,
            &quot;Source URL not specified&quot;);
} else {
    InputStream in = url.openStream();
    ObjectInputStream objIn = new ObjectInputStream(in);
    Object obj = objIn.readObject();
    if (obj instanceof JasperPrint) {

    } else {
        JOptionPane.showMessageDialog(this, obj.toString());
        return;
    }

    if (jasperPrint == null) {
        // 根据Servlet返回的URL（ObjectStream）产生JasperPrint对象
        jasperPrint = (JasperPrint) obj;

    }
    // 拦截出现空报表问题
    if (jasperPrint != null
            &amp;&amp; jasperPrint.getPages().size() &gt; 0) {
        /*
         * 调用JasperReport.jar中JasperViewer绘制报表Frame
         * JasperViewer继承自JFrame，采用setDefaultCloseOperation响应关闭窗口事件
         */

        ViewerFrame viewerFrame = new ViewerFrame(this
                .getAppletContext(), jasperPrint,isShowPrintButton);

        viewerFrame.setVisible(true);
        //viewerFrame.show();

        // JasperViewer viewer = new
        // JasperViewer(jasperPrint);
        // viewer.setVisible(true);
        // viewer.setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        // 如果请求为空弹出对话框予以提示
    } else {
        JOptionPane
                .showMessageDialog(this,
                        &quot;Please check Your Report SQL! It resulted in empty Report! &quot;);
        return;
    }
}
</code></pre></div>
<p>其中requestUrl为applet配置中的REPORT_URL，现实中可以采用此种方式传递参数到applet中。
下篇文章会介绍更合适的业务数据传递，?printView=true表示，传递printView参数对应的值为true，用来预览使用。
剩下的工作就是怎么按照自己的要求打印和预览了。<br>
** jasperReport为我们提供了打印和预览现成的方法： ** </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">// 打印报表
JasperPrintManager.printReport(print, false);

/*  预览报表
 * 调用JasperReport.jar中JasperViewer绘制报表Frame
 * JasperViewer继承自JFrame，采用setDefaultCloseOperation响应关闭窗口事件
 */
ViewerFrame viewerFrame = new ViewerFrame(this.getAppletContext(), jasperPrint);
viewerFrame.setVisible(true);
</code></pre></div>
<p>最后记着释放对象哦，浏览器会受不了得：  </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">url = null;
jasperPrint = null;
</code></pre></div>
<p>OK，客户端就出现了，参照demo没有什么难度，下一篇我会介绍一下具体的细节，及套打的实现。  </p>

</div>
<p class="leo-protect">
  作者：
  <a href="/">leo</a>
  　发布时间：2013年05月07日
  <br>
  原文：
  <a href="/2013/05/07/iReport-jasperReport-13">iReport+jasperReport之客户端打印</a>
  <br>
  标签： iReport、jasperReport
  <br/>
  版权所有，转载时必须以链接形式注明作者和原出处并保留本声明。
  <br>
</p>
<script type="text/javascript" src="/static/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="/static/js/prettify.js"></script>
<script type="text/javascript">
  $(function(){
    $("pre").addClass("prettyprint linenums");
    prettyPrint();
  });
</script>

<!-- Duoshuo Comment BEGIN -->
  <div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"jutleo"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- Duoshuo Comment END --></div></div>
          <div class="col-md-4">
            <div class="list-group">
              <a href="#" class="list-group-item list-group-item-success disabled">分类</a>
              
              <a href="/db/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">1</span>db </a>
              
              <a href="/server/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">2</span>server </a>
              
              <a href="/office/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">1</span>office </a>
              
              <a href="/javascript/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">6</span>javascript </a>
              
              <a href="/ireport/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">15</span>ireport </a>
              
              <a href="/blog/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">1</span>blog </a>
              
              <a href="/orm/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">2</span>orm </a>
              
              <a href="/technology/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">1</span>technology </a>
              
              <a href="/life/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">3</span>life </a>
              
              <a href="/spring/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">5</span>spring </a>
              
            </div>
            <div class="leo-article-category">
              <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=2975520964&verifier=eac976c7&dpc=1"></iframe>
            </div>

          </div>
      </div>

        </div>
        
      <div class="leo-foot">
        <p>
 Copyright &copy; 2010 - 2014 &nbsp;jutleo@gmail.com. 保留所有权利。
</p>
      </div>
    </body>
</html>
