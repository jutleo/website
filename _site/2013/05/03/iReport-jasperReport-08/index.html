<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>iReport+jasperReport之scriptlet</title>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
        <!-- Custom CSS -->
        <link rel="stylesheet" href="/static/css/leo.css">
        <link rel="stylesheet" href="/static/css/prettify.css">

    </head>
    <body>
      <div class="leo-head">
        <ul class="leo-nav">
  
    <li><a class="leo-nav-item" href="/">首页</a></li>
  
    <li><a class="leo-nav-item" href="/category.html">归档</a></li>
  
    <li><a class="leo-nav-item" href="/andy.html">豆豆</a></li>
  
    <li><a class="leo-nav-item last" href="/contant.html">联系我</a></li>
  
</ul>

      </div>
          </div>
      <div class="container">
        <div class="row">
          <div class="col-md-8"><div class="leo-category"><h1 class="leo-articel-title">iReport+jasperReport之scriptlet</h1>
<div class="post">
<p>提起scriptlet就不能不联想到它的强大功能，jasperReport也是支持scriptlet的哦，先分析一下JasperReport的API吧！
在填充报表时scriplet是一个非常有力的工具，JRAbstractScriptlet.java位于net.sf.jasperreports.engine包下是一个抽象类。  </p>

<p><img src="/static/img/20130502001.jpg" alt="显示效果">   </p>

<p><code>beforeReportInit()</code>, <code>afterReportInit()</code>, <code>beforePageInit()</code>, <code>afterPageInit()</code>, <code>beforeColumnInit()</code>, <code>afterColumnInit()</code>, 
<code>beforeGroupInit(String groupName)</code>, <code>afterGroupInit(String groupName)</code>   </p>

<p>看看这些名字就知道你能完成那些功能，这几个方法是要求我们实现的，jasperReport给我们提供了一个实现类JRDefaultScriptlet.java，
默认的空实现了上面几个方法，它只是很便利的为我们提供了所需的八个方法的空实现。
我们写自己的scriptlet时需要继承JRDefaultScriptlet.java这个类实现自己的相应的功能即可。  </p>

<p>先来看一个简单的例子：<br>
<img src="/static/img/20130502002.jpg" alt="显示效果">   </p>

<p>先看看模板文件的处理：  </p>

<p>新建时填写的这个类是下面我们要介绍的继承自JRDefaultScriptlet.java类，也就是在模板文件中我们要加上如下代码  </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">scriptletClass=&quot;org.bulktree.ireport.scriptlet.ScriptletReportDemo&quot;  
</code></pre></div>
<p>完整的模板文件如下：scriptletDemo.jrxml  </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;  ?&gt;
&lt;!-- Created with iReport - A designer for JasperReports --&gt;
&lt;!DOCTYPE jasperReport PUBLIC &quot;//JasperReports//DTD Report Design//EN&quot; &quot;http://jasperreports.sourceforge.net/dtds/jasperreport.dtd&quot;&gt;
&lt;jasperReport
         name=&quot;scriptletDemo&quot;
         columnCount=&quot;1&quot;
         printOrder=&quot;Vertical&quot;
         orientation=&quot;Portrait&quot;
         pageWidth=&quot;595&quot;
         pageHeight=&quot;842&quot;
         columnWidth=&quot;535&quot;
         columnSpacing=&quot;0&quot;
         leftMargin=&quot;30&quot;
         rightMargin=&quot;30&quot;
         topMargin=&quot;20&quot;
         bottomMargin=&quot;20&quot;
         whenNoDataType=&quot;NoPages&quot;
         scriptletClass=&quot;org.bulktree.ireport.scriptlet.ScriptletReportDemo&quot;
         isTitleNewPage=&quot;false&quot;
         isSummaryNewPage=&quot;false&quot;&gt;
    &lt;property name=&quot;ireport.scriptlethandling&quot; value=&quot;2&quot; /&gt;
    &lt;property name=&quot;ireport.encoding&quot; value=&quot;UTF-8&quot; /&gt;
    &lt;import value=&quot;java.util.*&quot; /&gt;
    &lt;import value=&quot;net.sf.jasperreports.engine.*&quot; /&gt;
    &lt;import value=&quot;net.sf.jasperreports.engine.data.*&quot; /&gt;

    &lt;parameter name=&quot;ReportTitle&quot; isForPrompting=&quot;true&quot; class=&quot;java.lang.String&quot;/&gt;

        &lt;background&gt;
            &lt;band height=&quot;0&quot;  isSplitAllowed=&quot;true&quot; &gt;
            &lt;/band&gt;
        &lt;/background&gt;
        &lt;title&gt;
            &lt;band height=&quot;20&quot;  isSplitAllowed=&quot;true&quot; &gt;
                &lt;textField isStretchWithOverflow=&quot;false&quot; isBlankWhenNull=&quot;false&quot; evaluationTime=&quot;Now&quot; hyperlinkType=&quot;None&quot;  hyperlinkTarget=&quot;Self&quot; &gt;
                    &lt;reportElement
                        mode=&quot;Opaque&quot;
                        x=&quot;193&quot;
                        y=&quot;0&quot;
                        width=&quot;134&quot;
                        height=&quot;18&quot;
                        backcolor=&quot;#FFCC33&quot;
                        key=&quot;textField&quot;/&gt;
                    &lt;box&gt;&lt;/box&gt;
                    &lt;textElement textAlignment=&quot;Center&quot; verticalAlignment=&quot;Middle&quot;&gt;
                        &lt;font pdfFontName=&quot;Helvetica-Bold&quot; size=&quot;12&quot; isBold=&quot;true&quot;/&gt;
                    &lt;/textElement&gt;
                &lt;textFieldExpression   class=&quot;java.lang.String&quot;&gt;&lt;![CDATA[$P{ReportTitle}]]&gt;&lt;/textFieldExpression&gt;
                &lt;/textField&gt;
            &lt;/band&gt;
        &lt;/title&gt;
        &lt;pageHeader&gt;
            &lt;band height=&quot;0&quot;  isSplitAllowed=&quot;true&quot; &gt;
            &lt;/band&gt;
        &lt;/pageHeader&gt;
        &lt;columnHeader&gt;
            &lt;band height=&quot;0&quot;  isSplitAllowed=&quot;true&quot; &gt;
            &lt;/band&gt;
        &lt;/columnHeader&gt;
        &lt;detail&gt;
            &lt;band height=&quot;264&quot;  isSplitAllowed=&quot;true&quot; &gt;
                &lt;textField isStretchWithOverflow=&quot;false&quot; isBlankWhenNull=&quot;false&quot; evaluationTime=&quot;Now&quot; hyperlinkType=&quot;None&quot;  hyperlinkTarget=&quot;Self&quot; &gt;
                    &lt;reportElement
                        x=&quot;85&quot;
                        y=&quot;20&quot;
                        width=&quot;329&quot;
                        height=&quot;61&quot;
                        forecolor=&quot;#FF0099&quot;
                        key=&quot;textField-1&quot;/&gt;
                    &lt;box&gt;&lt;/box&gt;
                    &lt;textElement textAlignment=&quot;Center&quot; verticalAlignment=&quot;Middle&quot;&gt;
                        &lt;font pdfFontName=&quot;Helvetica-Bold&quot; size=&quot;20&quot; isBold=&quot;true&quot;/&gt;
                    &lt;/textElement&gt;
                &lt;textFieldExpression   class=&quot;java.lang.String&quot;&gt;&lt;![CDATA[$P{REPORT_SCRIPTLET}.showInfor()]]&gt;&lt;/textFieldExpression&gt;
                &lt;/textField&gt;
            &lt;/band&gt;
        &lt;/detail&gt;
        &lt;columnFooter&gt;
            &lt;band height=&quot;0&quot;  isSplitAllowed=&quot;true&quot; &gt;
            &lt;/band&gt;
        &lt;/columnFooter&gt;
        &lt;pageFooter&gt;
            &lt;band height=&quot;0&quot;  isSplitAllowed=&quot;true&quot; &gt;
            &lt;/band&gt;
        &lt;/pageFooter&gt;
        &lt;summary&gt;
            &lt;band height=&quot;50&quot;  isSplitAllowed=&quot;true&quot; &gt;
            &lt;/band&gt;
        &lt;/summary&gt;
&lt;/jasperReport&gt;
</code></pre></div>
<p>下来看看怎么实现我们自己的scriplet    </p>

<p><strong>ScriptletReportDemo.java</strong></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">package org.bulktree.ireport.scriptlet;

import net.sf.jasperreports.engine.JRDefaultScriptlet;
import net.sf.jasperreports.engine.JRScriptletException;

/**
 * 
 * @author bulktree Email: jutleo@gmail.com
 * @Nov 26, 2008
 */
public class ScriptletReportDemo extends JRDefaultScriptlet {

    @Override
    public void afterColumnInit() throws JRScriptletException {
        System.out.println(&quot;**************************************afterColumnInit()**************************************&quot;);
    }

    @Override
    public void afterDetailEval() throws JRScriptletException {
        System.out.println(&quot;**************************************afterDetailEval()**************************************&quot;);
    }

    @Override
    public void afterGroupInit(String groupName) throws JRScriptletException {
        System.out.println(&quot;**************************************afterDetailEval()**************************************&quot;);
    }

    @Override
    public void afterPageInit() throws JRScriptletException {
        System.out.println(&quot;**************************************afterPageInit()**************************************&quot;);
    }

    @Override
    public void afterReportInit() throws JRScriptletException {
        System.out.println(&quot;**************************************afterReportInit() begin**************************************&quot;);

        String str = (String) this.getParameterValue(&quot;ReportTitle&quot;);
        System.out.println(&quot;report title=====&gt;&gt;&gt;&gt;&quot;+str);

        str += str.subSequence(0, str.length()-2);
        this.setParameterValue(&quot;ReportTitle&quot;, str);
        System.out.println(&quot;**************************************afterReportInit() end**************************************&quot;);
    }

    @Override
    public void beforeColumnInit() throws JRScriptletException {
        System.out.println(&quot;**************************************beforeColumnInit()**************************************&quot;);
    }

    @Override
    public void beforeDetailEval() throws JRScriptletException {
        System.out.println(&quot;**************************************beforeDetailEval()**************************************&quot;);
    }

    @Override
    public void beforeGroupInit(String groupName) throws JRScriptletException {
        System.out.println(&quot;**************************************beforeGroupInit()**************************************&quot;);
    }

    @Override
    public void beforePageInit() throws JRScriptletException {
        System.out.println(&quot;**************************************beforePageInit()**************************************&quot;);
    }

    @Override
    public void beforeReportInit() throws JRScriptletException {
        System.out.println(&quot;**************************************beforeReportInit()**************************************&quot;);
    }

    public String showInfor() throws JRScriptletException {
        return &quot;the is scriptlet scriptlet scriptlet the,sscriptlet report the is ascriptlet report this is a scriptlet report this is a scriptlet report&quot;;
    }
}
</code></pre></div>
<p>这段代码最后一个方法是我们自己的加的，用来在报表上显示一段文本。
我们知道对于一个Field、Parameter、Variable，JasperReport分别采用$F{FieldName}、$P{Parametername}、$V{VariableName}来引用，
而如果要引用ScriptletReportDemo.java类的showInfor()返回字符串显示在报表上，看看这个就知道了   </p>

<p><img src="/static/img/20130502003.jpg" alt="显示效果">  </p>

<p>在afterReportInit方法中我们把parameter字段取出来前后添上五个*号再set进去<br>
下来写一个test类测试一下：  </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">package org.bulktree.ireport.scriptlet;

import java.io.File;
import java.io.FileInputStream;
import java.io.InputStream;
import java.util.HashMap;

import net.sf.jasperreports.engine.JREmptyDataSource;
import net.sf.jasperreports.engine.JasperCompileManager;
import net.sf.jasperreports.engine.JasperFillManager;
import net.sf.jasperreports.engine.JasperPrint;
import net.sf.jasperreports.engine.JasperReport;
import net.sf.jasperreports.view.JasperViewer;

/**
 * 
 * @author bulktree Email: jutleo@gmail.com
 * @Nov 27, 2008
 */
public class ScriptletTestMain {

    public static void main(String[] args) {
        String path = &quot;D:/workspace/scriptletDemo.jrxml&quot;;

        File file = new File(path);
        InputStream in;
        try {

            HashMap parameters = new HashMap();
            parameters.put(&quot;ReportTitle&quot;, &quot;LAOSHULIN&quot;);
            in = new FileInputStream(file);
            JasperReport jasperReport = JasperCompileManager.compileReport(in);
            JasperPrint jasperPrint = JasperFillManager.fillReport(jasperReport,
                    parameters, new JREmptyDataSource());
            JasperViewer viewer = new JasperViewer(jasperPrint);
            viewer.setVisible(true);

        } catch (Exception e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }

    }
}
</code></pre></div>
<p>效果不错吧：  </p>

<p><img src="/static/img/20130502004.jpg" alt="显示效果"></p>

</div>
<p class="leo-protect">
  作者：
  <a href="/">leo</a>
  　发布时间：2013年05月03日
  <br>
  原文：
  <a href="/2013/05/03/iReport-jasperReport-08">iReport+jasperReport之scriptlet</a>
  <br>
  标签： iReport、jasperReport
  <br/>
  版权所有，转载时必须以链接形式注明作者和原出处并保留本声明。
  <br>
</p>
<script type="text/javascript" src="/static/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="/static/js/prettify.js"></script>
<script type="text/javascript">
  $(function(){
    $("pre").addClass("prettyprint linenums");
    prettyPrint();
  });
</script>

<!-- Duoshuo Comment BEGIN -->
  <div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"jutleo"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- Duoshuo Comment END --></div></div>
          <div class="col-md-4">
            <div class="list-group">
              <a href="#" class="list-group-item list-group-item-success disabled">分类</a>
              
              <a href="/db/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">1</span>db </a>
              
              <a href="/server/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">2</span>server </a>
              
              <a href="/office/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">1</span>office </a>
              
              <a href="/javascript/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">6</span>javascript </a>
              
              <a href="/ireport/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">15</span>ireport </a>
              
              <a href="/blog/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">1</span>blog </a>
              
              <a href="/orm/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">2</span>orm </a>
              
              <a href="/technology/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">1</span>technology </a>
              
              <a href="/life/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">3</span>life </a>
              
              <a href="/spring/"  class="list-group-item" title="查看所有此分类文章列表"><span class="badge">5</span>spring </a>
              
            </div>
            <div class="leo-article-category">
              <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=2975520964&verifier=eac976c7&dpc=1"></iframe>
            </div>

          </div>
      </div>

        </div>
        
      <div class="leo-foot">
        <p>
 Copyright &copy; 2010 - 2014 &nbsp;jutleo@gmail.com. 保留所有权利。
</p>
      </div>
    </body>
</html>
